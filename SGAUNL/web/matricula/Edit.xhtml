<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <f:metadata>
        <f:viewParam name="id" value="#{matriculaController.usuarioId}" />
        <f:event listener="#{matriculaController.findUserEnrollment()}" type="preRenderView"/>
    </f:metadata>

    <ui:composition template="/templates/plantilla.xhtml">
        <ui:define name="title">
            <h:outputText value="#{bundle.EditMatriculaTitle}"></h:outputText>
        </ui:define>
        <ui:define name="content">
            <h:form id="formEditMatricula">
                <p:panel header="Editar Matriculas" id="panelEditMatriculas">
                    <p:panelGrid columns="2">
                        <h:outputLabel value="#{bundle.ListMatriculaTitle_anioLectivo}"/>
                        <p:selectOneMenu converter="genericConverter" value="#{matriculaController.current.anioLectivo}">
                            <f:selectItems value="#{matriculaController.itemAnioActivo}"/>
                        </p:selectOneMenu>
                        <h:outputLabel value="#{bundle.ListMatriculaTitle_estudiante}"/>
                        <h:outputText value="#{matriculaController.current.usuario}" />

                        <h:outputLabel value="#{bundle.ListMatriculaTitle_numeroMatricula}"/>
                        <p:inputText required="true" label="Tipo de Matricula" value="#{matriculaController.current.numeroMatricula}"/>

                        <h:outputLabel value="#{bundle.ListMatriculaTitle_fechaMatricula}"/>
                        <h:outputText value="#{matriculaController.current.fechaMatricula}" >
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>

                        <h:outputLabel value="#{bundle.ListMatriculaTitle_tipoMatricula}"/>
                        <p:selectOneMenu label="Tipo de Matrícula" required="true" value="#{matriculaController.current.tipoMatricula}">
                            <f:selectItems value="#{typeListController.typeTipoMatriculas}"/>  
                        </p:selectOneMenu>

                        <h:outputLabel value="#{bundle.ListMatriculaTitle_segundaTerceraMatricula}"/>
                        <p:inputText label="Segunda o tercera matrícula" required="true" value="#{matriculaController.current.segundaTerceraMatricula}" />

                        <h:outputLabel value="#{bundle.ListMatriculaTitle_observaciones}"/>
                        <p:inputTextarea label="Observaciones" required="true" value="#{matriculaController.current.observaciones}" />
                        <h:outputLabel value="Nivel"/>
                        <p:selectOneMenu id="idNivel" converter="genericConverter" label="Nivel" required="true" value="#{matriculaController.current.curso.nivel}"
                                         valueChangeListener="#{matriculaController.valueChanged}">
                            <f:selectItems value="#{nivelController.itemsAvailableSelectOne}"/>  
                            <f:ajax event="valueChange" render="idEspecialidad" execute="@this"/>
                        </p:selectOneMenu>
                        <h:outputLabel value="Epecialidad"/>
                        <p:selectOneMenu id="idEspecialidad" 

                                         converter="genericConverter" label="Especialidad" 
                                         required="true" value="#{matriculaController.current.curso.especialidad}">

                            <f:selectItems value="#{especialidadController.itemsAvailableSelectOne}"/>  
                        </p:selectOneMenu>
                        <h:outputLabel value="#{bundle.ListMatriculaTitle_curso}"/>
                        <p:selectOneMenu converter="genericConverter" label="Curso" required="true" value="#{matriculaController.current.curso}">
                            <f:selectItems value="#{cursoController.itemsAvailableSelectOne}"/>  
                        </p:selectOneMenu>
                        <p:messages />

                        <f:facet name="footer">
                            <p:commandButton value="GUARDAR" action="#{matriculaController.persist()}"
                                             update="panelEditMatriculas"/>
                            <p:commandButton value="ACTUALIZAR"
                                             action="#{matriculaController.update()}"/>
                            <p:commandButton value="CANCELAR" action="#{matriculaController.cancelEdit()}" immediate="true" />

                        </f:facet>

                    </p:panelGrid>



                </p:panel>

            </h:form>

        </ui:define>
    </ui:composition>

</html>
